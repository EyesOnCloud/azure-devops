trigger:
- master

variables:
  tag: '$(Build.BuildId)'
  
pool: 
  name: default 
  demands: 
    - agent.name -equals controller
  
stages:
  - stage: Build
    displayName: Build Stage
    jobs:
     - job: Build
       displayName: Build job
       steps:
         - task: Docker@2
           inputs:
             containerRegistry: 'docker-hub'
             repository: 'azdevops'
             command: 'buildAndPush'
             Dockerfile: '**/Dockerfile'
             tags: 
               $(tag)
         - task: Bash@3
           inputs:
             targetType: 'inline'
             script: |
               kubectl apply -f deployment.yml

